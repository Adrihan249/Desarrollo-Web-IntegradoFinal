name: CI - Validar Dockerfile y Build

on:
  push:
    branches: ["main"]
  pull_request:

jobs:
  validate-dockerfile:
    name: Lint y Build Dockerfile
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # ------------------------------
      # Paso 1: Lint del Dockerfile
      # ------------------------------
      - name: Instalar Hadolint
        run: |
          sudo wget -O /usr/local/bin/hadolint \
            https://github.com/hadolint/hadolint/releases/download/v2.12.0/hadolint-Linux-x86_64
          sudo chmod +x /usr/local/bin/hadolint

      - name: Ejecutar Hadolint
        run: hadolint Desarrollo-Web-IntegradoFinal/asana-clone/Dockerfile

      # ------------------------------
      # Paso 2: Construir la imagen Docker
      # ------------------------------
      - name: Build Docker Image
        run: |
          docker build \
            -t test-spring-app \
            -f Desarrollo-Web-IntegradoFinal/asana-clone/Dockerfile \
            Desarrollo-Web-IntegradoFinal/asana-clone

      # ------------------------------
      # Paso 3: Test r√°pido de arranque
      # ------------------------------
      - name: Run and test container
        run: |
          docker run -d --name test-app -p 8080:8080 test-spring-app
          sleep 5
          docker logs test-app
